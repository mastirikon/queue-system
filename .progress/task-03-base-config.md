# üìã –ó–∞–¥–∞–Ω–∏–µ #3: –ë–∞–∑–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–î–∞—Ç–∞ –≤—ã–¥–∞—á–∏:** 2025-12-16  
**–°—Ç–∞—Ç—É—Å:** üîÑ –í —Ä–∞–±–æ—Ç–µ  
**–§–∞–∑–∞:** Setup & Project Structure

---

## üéØ –¶–µ–ª—å
–°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è, type-safe –∑–∞–≥—Ä—É–∑–∫–æ–π –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π.

---

## üìù –î–µ—Ç–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

### –ß–∞—Å—Ç—å 1: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `internal/config/config.go`:

```go
package config

import (
	"time"

	"github.com/caarlos0/env/v10"
)

// Config —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
type Config struct {
	Env   string `env:"ENV" envDefault:"development"`
	
	// API –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
	API APIConfig `envPrefix:"API_"`
	
	// Worker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
	Worker WorkerConfig `envPrefix:"WORKER_"`
	
	// Redis –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
	Redis RedisConfig `envPrefix:"REDIS_"`
}

// APIConfig ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ API —Å–µ—Ä–≤–∏—Å–∞
type APIConfig struct {
	Port            int           `env:"PORT" envDefault:"8080"`
	Host            string        `env:"HOST" envDefault:"0.0.0.0"`
	ReadTimeout     time.Duration `env:"READ_TIMEOUT" envDefault:"10s"`
	WriteTimeout    time.Duration `env:"WRITE_TIMEOUT" envDefault:"10s"`
	ShutdownTimeout time.Duration `env:"SHUTDOWN_TIMEOUT" envDefault:"30s"`
}

// WorkerConfig ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Worker —Å–µ—Ä–≤–∏—Å–∞
type WorkerConfig struct {
	Concurrency     int           `env:"CONCURRENCY" envDefault:"10"`
	RetryInterval   time.Duration `env:"RETRY_INTERVAL" envDefault:"10s"`
	MaxRetries      int           `env:"MAX_RETRIES" envDefault:"144"` // 24 —á–∞—Å–∞ –ø—Ä–∏ 10 —Å–µ–∫ –∏–Ω—Ç–µ—Ä–≤–∞–ª–µ
	RequestTimeout  time.Duration `env:"REQUEST_TIMEOUT" envDefault:"30s"`
}

// RedisConfig ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Redis
type RedisConfig struct {
	Addr     string `env:"ADDR" envDefault:"localhost:6379"`
	Password string `env:"PASSWORD" envDefault:""`
	DB       int    `env:"DB" envDefault:"0"`
}

// Load –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
func Load() (*Config, error) {
	cfg := &Config{}
	if err := env.Parse(cfg); err != nil {
		return nil, err
	}
	return cfg, nil
}
```

---

### –ß–∞—Å—Ç—å 2: –ü—Ä–∏–º–µ—Ä .env —Ñ–∞–π–ª–∞

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `configs/.env.example`:

```bash
# –û–∫—Ä—É–∂–µ–Ω–∏–µ (development, production)
ENV=development

# API –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
API_PORT=8080
API_HOST=0.0.0.0
API_READ_TIMEOUT=10s
API_WRITE_TIMEOUT=10s
API_SHUTDOWN_TIMEOUT=30s

# Worker –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
WORKER_CONCURRENCY=10
WORKER_RETRY_INTERVAL=10s
WORKER_MAX_RETRIES=144
WORKER_REQUEST_TIMEOUT=30s

# Redis –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
REDIS_ADDR=localhost:6379
REDIS_PASSWORD=
REDIS_DB=0
```

---

### –ß–∞—Å—Ç—å 3: README –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `configs/README.md`:

```markdown
# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è.

### –û–±—â–∏–µ

- `ENV` ‚Äî –æ–∫—Ä—É–∂–µ–Ω–∏–µ (development/production), –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `development`

### API —Å–µ—Ä–≤–∏—Å

- `API_PORT` ‚Äî –ø–æ—Ä—Ç HTTP —Å–µ—Ä–≤–µ—Ä–∞, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `8080`
- `API_HOST` ‚Äî —Ö–æ—Å—Ç –¥–ª—è –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `0.0.0.0`
- `API_READ_TIMEOUT` ‚Äî —Ç–∞–π–º–∞—É—Ç —á—Ç–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `10s`
- `API_WRITE_TIMEOUT` ‚Äî —Ç–∞–π–º–∞—É—Ç –∑–∞–ø–∏—Å–∏ –æ—Ç–≤–µ—Ç–∞, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `10s`
- `API_SHUTDOWN_TIMEOUT` ‚Äî —Ç–∞–π–º–∞—É—Ç graceful shutdown, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `30s`

### Worker —Å–µ—Ä–≤–∏—Å

- `WORKER_CONCURRENCY` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º—ã—Ö –∑–∞–¥–∞—á, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `10`
- `WORKER_RETRY_INTERVAL` ‚Äî –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É retry, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `10s`
- `WORKER_MAX_RETRIES` ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ (144 = 24 —á–∞—Å–∞ –ø—Ä–∏ 10 —Å–µ–∫), –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `144`
- `WORKER_REQUEST_TIMEOUT` ‚Äî —Ç–∞–π–º–∞—É—Ç HTTP –∑–∞–ø—Ä–æ—Å–∞ –∫ –≤–Ω–µ—à–Ω–µ–º—É API, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `30s`

### Redis

- `REDIS_ADDR` ‚Äî –∞–¥—Ä–µ—Å Redis —Å–µ—Ä–≤–µ—Ä–∞, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `localhost:6379`
- `REDIS_PASSWORD` ‚Äî –ø–∞—Ä–æ–ª—å (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è), –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: –ø—É—Å—Ç–æ
- `REDIS_DB` ‚Äî –Ω–æ–º–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `0`

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### Development

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ (–æ–Ω –≤ `.gitignore`):

\`\`\`bash
cp configs/.env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π .env –ø–æ–¥ —Å–≤–æ–∏ –Ω—É–∂–¥—ã
\`\`\`

### Production

–ò—Å–ø–æ–ª—å–∑—É–π –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞–ø—Ä—è–º—É—é (Docker, K8s, systemd –∏ —Ç.–¥.).
```

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

- [ ] –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `internal/config/config.go` —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º
- [ ] –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `configs/.env.example` —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- [ ] –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `configs/README.md` —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π
- [ ] –ö–æ–¥ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –í–µ—Ä—Å–∏—è Go –≤ `go.mod` –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ (–µ—Å–ª–∏ –±—ã–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞)

---

## üìö –¢–µ–æ—Ä–∏—è: –ü–æ—á–µ–º—É —Ç–∞–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞?

### 1. **–ü—Ä–µ—Ñ–∏–∫—Å—ã `envPrefix`**
```go
API APIConfig `envPrefix:"API_"`
```

–í—Å–µ –ø–æ–ª—è –≤–Ω—É—Ç—Ä–∏ `APIConfig` –±—É–¥—É—Ç –∏–º–µ—Ç—å –ø—Ä–µ—Ñ–∏–∫—Å `API_`:
- `Port` ‚Üí `API_PORT`
- `Host` ‚Üí `API_HOST`

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ:** –õ–æ–≥–∏—á–µ—Å–∫–∞—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞, –∏–∑–±–µ–≥–∞–µ–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∏–º—ë–Ω.

### 2. **–ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `envDefault`**
```go
Port int `env:"PORT" envDefault:"8080"`
```

–ï—Å–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –Ω–µ –∑–∞–¥–∞–Ω–∞ ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ:** –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç "–∏–∑ –∫–æ—Ä–æ–±–∫–∏" –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.

### 3. **time.Duration**
```go
ReadTimeout time.Duration `env:"READ_TIMEOUT" envDefault:"10s"`
```

–ü–∞—Ä—Å–∏—Ç —Å—Ç—Ä–æ–∫–∏ —Ç–∏–ø–∞: `"10s"`, `"5m"`, `"1h30m"`.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ:** –£–¥–æ–±–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç, –Ω–µ –Ω—É–∂–Ω–æ –ø–∞—Ä—Å–∏—Ç—å –≤—Ä—É—á–Ω—É—é.

### 4. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ API –∏ Worker –∫–æ–Ω—Ñ–∏–≥–æ–≤**
–•–æ—Ç—è –æ–Ω–∏ –≤ –æ–¥–Ω–æ–º –º–æ–¥—É–ª–µ, —É –Ω–∏—Ö —Ä–∞–∑–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
- API: —Ç–∞–π–º–∞—É—Ç—ã HTTP, –ø–æ—Ä—Ç
- Worker: concurrency, retry –ª–æ–≥–∏–∫–∞

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ:** –Ø—Å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å.

### 5. **`.env.example` vs `.env`**
- `.env.example` ‚Äî –≤ git, —à–∞–±–ª–æ–Ω –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- `.env` ‚Äî –Ω–µ –≤ git (–≤ `.gitignore`), –ª–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ:** –°–µ–∫—Ä–µ—Ç—ã –Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.

---

## üéì –†–∞—Å—á—ë—Ç—ã –¥–ª—è Worker

### –ü–æ—á–µ–º—É `MAX_RETRIES=144`?

–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ: **Retention 24 —á–∞—Å–∞** —Å retry –∫–∞–∂–¥—ã–µ **10 —Å–µ–∫—É–Ω–¥**.

–†–∞—Å—á—ë—Ç:
```
24 —á–∞—Å–∞ = 86400 —Å–µ–∫—É–Ω–¥
Retry –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ = 86400 / 10 / 60 = 144
```

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –∑–∞–¥–∞—á–∞ –±—É–¥–µ—Ç –ø—ã—Ç–∞—Ç—å—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è **144 —Ä–∞–∑–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤**, –ø–æ—Å–ª–µ —á–µ–≥–æ –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–∞ –∏–∑ –æ—á–µ—Ä–µ–¥–∏.

### –ü–æ—á–µ–º—É `CONCURRENCY=10`?

–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
- 750MB RAM
- 1 vCPU
- 20-30 –∑–∞–¥–∞—á/–º–∏–Ω

–ü—Ä–∏ 10 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤–æ—Ä–∫–µ—Ä–∞—Ö:
- –ö–∞–∂–¥—ã–π –≤–æ—Ä–∫–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–¥–∞—á—É –∑–∞ ~1-5 —Å–µ–∫
- –ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å: ~120-600 –∑–∞–¥–∞—á/–º–∏–Ω
- –ó–∞–ø–∞—Å –¥–ª—è –ø–∏–∫–æ–≤—ã—Ö –Ω–∞–≥—Ä—É–∑–æ–∫

**–ú–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å/—É–º–µ–Ω—å—à–∏—Ç—å** –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∞–ª—å–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏.

---

## üö® –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ù–µ —Ö—Ä–∞–Ω–∏ —Å–µ–∫—Ä–µ—Ç—ã –≤ –∫–æ–¥–µ!**
   - –ü–∞—Ä–æ–ª–∏, —Ç–æ–∫–µ–Ω—ã ‚Üí —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
   - `.env` –≤ `.gitignore` ‚úÖ

2. **Production vs Development**
   - Development: –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `.env` —Ñ–∞–π–ª
   - Production: env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ—Ç Docker/K8s

3. **–í–∞–ª–∏–¥–∞—Ü–∏—è**
   - –°–µ–π—á–∞—Å –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ `env` —Ç–µ–≥–∏
   - –ü–æ–∑–∂–µ –¥–æ–±–∞–≤–∏–º `validator` —Ç–µ–≥–∏ –¥–ª—è —Å–ª–æ–∂–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤, –ø—Ä–æ–≤–µ—Ä—å –∫–æ–º–ø–∏–ª—è—Ü–∏—é:

```bash
go build ./internal/config
```

–ï—Å–ª–∏ –æ—à–∏–±–æ–∫ –Ω–µ—Ç ‚Äî –æ—Ç–ª–∏—á–Ω–æ! ‚úÖ

---

**–ö–æ–≥–¥–∞ –∑–∞–∫–æ–Ω—á–∏—à—å:**
1. –ü–æ–∫–∞–∂–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `internal/config/config.go` (–ø–µ—Ä–≤—ã–µ 30 —Å—Ç—Ä–æ–∫)
2. –ü–æ–∫–∞–∂–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `configs/.env.example`
3. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏ —á—Ç–æ `go build ./internal/config` —Ä–∞–±–æ—Ç–∞–µ—Ç

–Ø –ø—Ä–æ–≤–µ—Ä—é –∏ –¥–∞–¥–∏–º —Å–ª–µ–¥—É—é—â–µ–µ –∑–∞–¥–∞–Ω–∏–µ! üéØ


